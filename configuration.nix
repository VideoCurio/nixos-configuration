# Do NOT Edit this file - it was generated by 'curios-install'
# and may be overwritten by future updates. Users can edit settings.nix instead.

{ config, lib, pkgs, ... }:

{
  # Split configurations files, see: https://nixos.wiki/wiki/NixOS_modules
  imports = [
    ##################### Step 1: Hardware #####################
    # Include the results of the hardware scan.
    # You could re-generated one with 'sudo nixos-generate-config --no-filesystems'.
    # For hardware related configurations, see: https://github.com/NixOS/nixos-hardware
    # Do NOT edit
    ./hardware-configuration.nix
    ##################### Step 2: Modules #####################
    # Import all modules, activate or deactivate them in settings.nix
    ./modules/default.nix
    ##################### Step 3: User #####################
    # Me
    ./user-me.nix
    # User custom settings
    ./settings.nix
  ];

  # updated by curios-install
  networking.hostName = config.curios.system.hostname;

  ############# Settings belows this line should not be changed! #############

  # Set time zone.
  time.timeZone = config.curios.system.timeZone;

  # Select internationalisation properties. See 'locale' and 'locale -a'
  i18n = {
    defaultCharset = "UTF-8";
    defaultLocale = config.curios.system.i18n.locale;
    extraLocales = "all"; # Support all glibc locales
    extraLocaleSettings = {
      LC_ADDRESS = config.curios.system.i18n.locale;
      LC_IDENTIFICATION = config.curios.system.i18n.locale;
      LC_MEASUREMENT = config.curios.system.i18n.locale;
      LC_MONETARY = config.curios.system.i18n.locale;
      LC_NAME = config.curios.system.i18n.locale;
      LC_NUMERIC = config.curios.system.i18n.locale;
      LC_PAPER = config.curios.system.i18n.locale;
      LC_TELEPHONE = config.curios.system.i18n.locale;
      LC_TIME = config.curios.system.i18n.locale;
    };
    #inputMethod = {
    #  type = "fcitx5";
    #  enable = true;
    #  fcitx5.waylandFrontend = true;
    #  fcitx5.addons = with pkgs; [
    #    fcitx5-gtk
    #    fcitx5-chinese-addons  # table input method support
    #    fcitx5-nord            # a color theme
    #  ];
    #};
  };

  console = {
    earlySetup = true; # initrd setup
    font = "LatArCyrHeb-16";
    useXkbConfig = false; # use xkb.options in tty.
    keyMap = config.curios.system.keyboard;
  };

  # List packages installed in system profile.
  # You can use https://search.nixos.org/ to find more packages (and options).
  environment.systemPackages = with pkgs; [
    # Basics
    wget
    curl
    fastfetch
    busybox
    git
    gnupg
    pinentry-curses
    gnused
    pciutils
  ]
  ++ lib.optionals config.services.desktopManager.cosmic.xwayland.enable [
    wl-clipboard
  ]
  ++ lib.optionals config.curios.hardware.amdGpu.enable [
    btop-rocm
  ]
  ++ lib.optionals config.curios.hardware.nvidiaGpu.enable [
    btop-cuda
  ]
  ++ lib.optionals (!config.curios.hardware.nvidiaGpu.enable && !config.curios.hardware.amdGpu.enable) [
    btop
  ];

  # Some programs need SUID wrappers, can be configured further or are
  # started in user sessions.
  #programs.mtr.enable = true;
  programs.gnupg.agent = {
    enable = true;
    enableSSHSupport = false; # Let's programs.ssh.startAgent do this job
    pinentryPackage = pkgs.pinentry-curses;
  };

  # Allow unfree packages, could be overridden by some modules.
  nixpkgs.config.allowUnfree =
    if config.curios.hardware.nvidiaGpu.enable then
      true
    else
      if config.curios.desktop.apps.gaming.enable then
        true
      else
        false
  ;

  system = {
    # Automatic OS updates and cleanup
    autoUpgrade = {
      enable = true;
      dates = "03:40";
      randomizedDelaySec = "5min";
      allowReboot = false; # Reboot on new kernel, initrd or kernel module.
      channel = "https://channels.nixos.org/nixos-25.05"; # The URI of the NixOS channel to use for automatic upgrades.
    };
    # Copy the NixOS configuration file and link it from the resulting system
    # (/run/current-system/configuration.nix). This is useful in case you
    # accidentally delete configuration.nix.
    copySystemConfiguration = true;
    # CuriOS variant version
    nixos.variantName = "CuriOS";
    nixos.variant_id = "unstable";
  };

  # Collect garbage
  nix = {
    gc = {
      automatic = true;
      dates = "daily";
      options = "--delete-older-than 7d";
    };
    settings = {
      auto-optimise-store = true;
      # Allowing Flakes
      experimental-features = [ "nix-command" "flakes" ];
      # List of users that have additional rights when connecting to the Nix daemon.
      trusted-users = [ "@wheel" ];
    };
  };
}
